// =================================================================
// TravelPath Photo Service - gRPC Protocol Definition
// =================================================================
// 
// Server endpoints:
//   REST API: https://travelpath.cocktails.rocks
//   gRPC:     travelpath.cocktails.rocks:50051
// 
// This service allows partner applications to upload photos
// that will be displayed in TravelPath.
// =================================================================

syntax = "proto3";

package photo;

option java_package = "com.travelpath.grpc";
option java_outer_classname = "PhotoServiceProto";

// =================================================================
// PhotoService
// =================================================================
service PhotoService {
    // Upload a photo with all metadata (matches Android Photo data class)
    rpc UploadPhoto(PhotoRequest) returns (PhotoResponse);
    
    // Upload multiple photos in a stream
    rpc UploadPhotoBatch(stream PhotoRequest) returns (BatchPhotoResponse);
}

// GeoPoint (matches Android Firestore GeoPoint)
message GeoPoint {
    double latitude = 1;
    double longitude = 2;
}

// Photo request format (matches Android data class Photo)
message PhotoRequest {
    string photo_id = 1;              // Optional, auto-generated if empty
    repeated string media_uris = 2;   // List of photo URLs
    string thumbnail_url = 3;
    string audio_url = 4;             // Optional
    string description = 5;
    repeated string ai_tags = 6;
    string category = 7;              // "Nature", "Urban", etc.
    
    // Location
    string location_name = 8;
    GeoPoint geo_point = 9;
    string geohash = 10;              // Auto-calculated if not provided
    string continent = 11;            // Auto-determined if not provided
    
    // Author
    string author_id = 12;
    string author_name = 13;
    string author_avatar = 14;
    
    // Visibility
    string visibility = 15;           // "PUBLIC" or "GROUP"
    string group_id = 16;             // Only if visibility is GROUP
    int32 like_count = 17;
    
    int64 timestamp = 18;             // Milliseconds since epoch
    
    // Binary photo data (for direct upload)
    bytes photo_data = 19;
    string content_type = 20;         // "image/jpeg", "image/png"
    string source_app = 21;           // Your app identifier
}

// Response
message PhotoResponse {
    bool success = 1;
    string photo_id = 2;
    string error_message = 3;
    repeated string media_urls = 4;
    string thumbnail_url = 5;
    string audio_url = 6;
}

// Batch response
message BatchPhotoResponse {
    int32 success_count = 1;
    int32 failed_count = 2;
    repeated PhotoResponse responses = 3;
}

// =================================================================
// Example Usage (Kotlin/Android)
// =================================================================
// 
// val channel = ManagedChannelBuilder
//     .forAddress("travelpath.cocktails.rocks", 50051)
//     .usePlaintext()  // gRPC без TLS на порту 50051
//     .build()
// 
// val stub = PhotoServiceGrpc.newBlockingStub(channel)
// 
// val geoPoint = GeoPoint.newBuilder()
//     .setLatitude(48.8566)
//     .setLongitude(2.3522)
//     .build()
// 
// val request = PhotoRequest.newBuilder()
//     .setDescription("Beautiful sunset in Paris")
//     .setCategory("Nature")
//     .setLocationName("Eiffel Tower")
//     .setGeoPoint(geoPoint)
//     .setAuthorId("user_123")
//     .setAuthorName("John Doe")
//     .setVisibility("PUBLIC")
//     .setPhotoData(ByteString.copyFrom(photoBytes))
//     .setContentType("image/jpeg")
//     .setSourceApp("partner_app")
//     .build()
// 
// val response = stub.uploadPhoto(request)
// println("Success: ${response.success}, Photo ID: ${response.photoId}")
// 
// =================================================================
